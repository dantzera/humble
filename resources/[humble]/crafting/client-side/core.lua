-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module("vrp","lib/Tunnel")
-----------------------------------------------------------------------------------------------------------------------------------------
-- CONNECTION
-----------------------------------------------------------------------------------------------------------------------------------------
vSERVER = Tunnel.getInterface("crafting")
-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIABLES
-----------------------------------------------------------------------------------------------------------------------------------------
local Timer = 0
local Select = ""
-----------------------------------------------------------------------------------------------------------------------------------------
-- CRAFTING
-----------------------------------------------------------------------------------------------------------------------------------------
local Crafting = {
	-- Framework
	["2"] = { vec3(-382.72,261.91,86.36),"Food" },
	["3"] = { vec3(1991.28,3724.65,34.83),"Food" },
	["4"] = { vec3(82.45,-1553.26,29.59),"Lixeiro" },
	["5"] = { vec3(287.36,2843.6,44.7),"Lixeiro" },
	["6"] = { vec3(-413.68,6171.99,31.48),"Lixeiro" },
	["7"] = { vec3(2921.17,2653.46,43.31),"Mining" },
	["8"] = { vec3(1136.02,-992.15,46.43),"Money" },
	["9"] = { vec3(1135.84,-990.8,46.42),"Money" },
	["10"] = { vec3(1135.67,-989.54,46.44),"Money" },
	["11"] = { vec3(1135.5,-988.23,46.41),"Money" },
	["12"] = { vec3(-922.6,-1414.1,7.75),"TokensWeapons" },
	-- Restaurants
	["13"] = { vec3(-1847.16,-1194.05,14.28),"Pearls" },
	-- Contraband Sul
	["14"] = { vec3(2186.77,5581.2,53.9),"Chiliad" },
	["15"] = { vec3(-161.72,-1609.33,33.46),"Families" },
	["16"] = { vec3(1421.29,6328.41,23.87),"Highways" },
	["17"] = { vec3(325.69,-1997.49,24.02),"Vagos" },
	["18"] = { vec3(710.73,-969.42,30.19),"BackpackSell" },
    -- Contraband North #1
	["19"] = { vec3(-2553.04,2303.6,33.32),"GasStation" },
	["20"] = { vec3(-2172.99,4291.12,45.76),"Hookies" },
	["21"] = { vec3(156.01,6357.12,28.05),"RoadKill" },
	["22"] = { vec3(2892.18,4428.17,45.09),"Union" },
	-- Contraband North #2
	["23"] = { vec3(1548.86,3796.07,30.35),"Fishing" },
	["24"] = { vec3(-3039.99,94.81,8.82),"Resort" },
	["25"] = { vec3(1982.57,3049.91,50.61),"YellowJack" },
	["26"] = { vec3(1957.28,3825.8,31.99),"Blarneys" },
	-- Favelas
	["27"] = { vec3(1935.84,-991.45,88.19),"Favela1" },
	["28"] = { vec3(-435.32,1525.44,403.66),"Favela2" },
	["29"] = { vec3(2392.79,862.67,120.8),"Favela3" },
	["30"] = { vec3(3273.15,5156.6,31.69),"Favela4" },
	["31"] = { vec3(-1695.64,4359.54,69.2),"Favela5" },
	-- ["32"] = { vec3(2175.04,4045.95,34.36),"Sandy" },
	-- ["33"] = { vec3(1550.16,-2454.24,80.37),"Petroleo" },
	-- ["34"] = { vec3(-3110.99,1422.21,29.97),"Praia-1" },
	-- ["35"] = { vec3(-3130.2,1702.83,41.01),"Praia-2" },
	-- ["36"] = { vec3(-601.03,2197.69,126.27),"Zancudo" },
	-- Mafias
	["37"] = { vec3(1400.84,1138.64,109.63),"Madrazzo" },
	["38"] = { vec3(503.97,2668.51,44.48),"Route68" },
	["39"] = { vec3(2745.12,4959.87,35.17),"Beacon" },
	["40"] = { vec3(-1871.2,2061.28,135.28),"Vineyard" },
	-- ["41"] = { vec3(-982.88,-248.05,38.2),"FuriousRecords" },
	["42"] = { vec3(-1370.11,-625.94,30.15),"Bahamas" },
	["43"] = { vec3(2563.22,3876.85,37.41),"Training" },
	["44"] = { vec3(-524.45,2956.0,27.68),"Lake" },
	-- Races
	["45"] = { vec3(471.55,-1310.95,29.27),"Races" },
	["46"] = { vec3(2859.27,1616.84,25.43),"Scuba" },
	-- Drugs Exclusives
	["47"] = { vec3(-1195.14,-1577.4,4.6),"Cbum" },
	["48"] = { vec3(-1171.25,-1571.16,4.67),"Rivotril" },
}
-----------------------------------------------------------------------------------------------------------------------------------------
-- THREADSTART
-----------------------------------------------------------------------------------------------------------------------------------------
CreateThread(function()
	for Number,v in pairs(Crafting) do
		exports["target"]:AddCircleZone("Crafting:"..Number, v[1], 1.0, {
			name = "Crafting:"..Number,
			heading = 3374176
		},{
			shop = Number,
			Distance = v[6] or 1.75,
			options = {
				{
					event = "crafting:Open",
					label = "Abrir",
					tunnel = "shop"
				}
			}
		})
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CRAFTING:OPEN
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("crafting:Open", function(Number)
	local v = Crafting[Number]
	if v then
		if vSERVER.Permission(v[2]) and vSERVER.Verify() then
			if v[2] ~= Select and GetGameTimer() < Timer then
				TriggerEvent("Notify", "amarelo", "Produção em andamento.", 5000)
			else
				Select = v[2]
				TriggerScreenblurFadeIn(500)
				SetNuiFocus(true, true)
				SendNUIMessage({ action = "OpenCraft", data = vSERVER.Request(Select) })
			end
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CLOSE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Close",function(Data,Callback)
	SetNuiFocus(false,false)
	TriggerScreenblurFadeOut(250.0)
    Wait(250)
	Callback("Ok")
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- OWNED
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Owned",function(Data,Callback)
	Callback(vSERVER.Owned(Data["id"],Data["key"]))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CRAFTING
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Crafting",function(Data,Callback)
	if GetGameTimer() >= Timer then
		Timer = GetGameTimer() + Data["time"] * 1000

		SetTimeout(Data["time"] * 1000,function()
			vSERVER.Crafting(Data["id"],Data["key"],Data["amount"])
		end)

		Callback(true)
	else
		TriggerEvent("Notify","amarelo","Produção em andamento.",5000)
		Callback(false)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CRAFTING:INVENTORY
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent("crafting:Inventory")
AddEventHandler("crafting:Inventory",function()
	if "Inventory" ~= Select and GetGameTimer() < Timer then
		TriggerEvent("Notify","amarelo","Produção em andamento.",5000)
		return
	end

	Select = "Inventory"
	SetNuiFocus(true,true)
	SendNUIMessage({ action = "OpenCraft", data = vSERVER.Request("Inventory") })
end)