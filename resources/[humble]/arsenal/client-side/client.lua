-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module("vrp","lib/Tunnel")
local Proxy = module("vrp","lib/Proxy")
vRP = Proxy.getInterface("vRP")
-----------------------------------------------------------------------------------------------------------------------------------------
-- CONNECTION
-----------------------------------------------------------------------------------------------------------------------------------------
Humble = {}
Tunnel.bindInterface("arsenal",Humble)
Humble = Tunnel.getInterface("arsenal")
vSERVER = Tunnel.getInterface("arsenal")
-----------------------------------------------------------------------------------------------------------------------------------------
-- arsenal
-----------------------------------------------------------------------------------------------------------------------------------------
local arsenalList = {
	-- Police
	{ -2382.89,3303.35,38.13,"Police",false },
	{ 364.87,-1604.31,25.99,"Police",false },
	{ 1843.22,2573.75,46.32,"Police",false },
	{ 1861.93,3688.11,34.56,"Police",false },
	{ -449.65,6015.39,37.21,"Police",false },
	-- Comanf (Public)
	{ 3991.61,1839.13,23.52,"Comanf",false }
}
-----------------------------------------------------------------------------------------------------------------------------------------
-- THREADSTART
-----------------------------------------------------------------------------------------------------------------------------------------
CreateThread(function()
	SetNuiFocus(false,false)

	for k,v in pairs(arsenalList) do
		exports["target"]:AddCircleZone("Arsenal:"..k,vec3(v[1],v[2],v[3]),1.75,{
			name = "Arsenal:"..k,
			heading = 3374176
		},{
			shop = k,
			Distance = 1.75,
			options = {
				{
					event = "arsenal:openArsenal",
					label = "Abrir",
					tunnel = "shop"
				}
			}
		})
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- arsenal:OPEN
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("arsenal:openArsenal", function(shopId)
    if Humble.requestPolice() then
        TriggerScreenblurFadeIn(500)
        SetNuiFocus(true, true)
        TriggerEvent("hud:Active", false)
        SendNUIMessage({ action = "show", items = Humble.getItems(), money = Humble.getMoney() })
    end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CLOSE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("close",function(data)
	TriggerScreenblurFadeOut(250.0)
    Wait(250)
	SetNuiFocus(false,false)
    SetCursorLocation(0.5, 0.5)
	TriggerEvent("hud:Active", true)
	SendNUIMessage({ action = "hide" })
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CALLBACK:COMPRAR
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("comprar", function(data)
	if data and data.item and not block then
		setBlock()
		Humble.buyItem(data.item)
	end
end) 
-----------------------------------------------------------------------------------------------------------------------------------------
-- CALLBACK:BLOCK
-----------------------------------------------------------------------------------------------------------------------------------------
function setBlock()
	block = true
	Citizen.CreateThread(function()
		local time = 3
		while time > 0 do
			Wait(1000)
			time = time - 1
		end
		block = false
	end)
end